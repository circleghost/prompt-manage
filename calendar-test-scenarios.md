# Calendar Agent 測試情況清單

## 📋 測試目標
驗證 Calendar Agent 在各種情況下的正確行為，確保：
- 正確調用工具而非依賴記憶
- 兩段式確認機制運作正常
- 衝突檢查和智能重複檢測功能
- 錯誤處理和邊界情況

---

## 🎯 基本功能測試

### 1. 建立事件測試

#### 1.1 基本建立
- **測試指令**：「幫我建立明天下午2點的會議」
- **預期行為**：search_events 檢查衝突 → needs_user_confirmation → 用戶確認 → create_event
- **驗證點**：實際調用 create_event 工具，不依賴記憶

#### 1.2 詳細資訊建立
- **測試指令**：「建立會議『與客戶討論合作』，時間：明天下午3-4點，邀請 john@company.com」
- **預期行為**：包含 attendees 和 createMeet 參數的 create_event 調用
- **驗證點**：參數格式正確，email 格式符合要求

#### 1.3 時間衝突情況
- **前置條件**：明天下午2點已有會議
- **測試指令**：「建立明天下午2點的團隊會議」
- **預期行為**：search_events 發現衝突 → conflict_detected → 提供替代時段
- **驗證點**：回傳建議時段，不強制建立

### 2. 查詢事件測試

#### 2.1 時段查詢
- **測試指令**：「查詢明天有哪些會議」
- **預期行為**：search_events，q 參數為空，時間範圍為明天整天
- **驗證點**：正確的 timeMin/timeMax 格式

#### 2.2 關鍵字搜尋
- **測試指令**：「找到與旺旺相關的會議」
- **預期行為**：search_events，q 參數為「旺旺」，較寬時間範圍
- **驗證點**：關鍵字搜尋功能正常

#### 2.3 特定事件詳情
- **測試指令**：「查看明天2點會議的詳細資訊」
- **預期行為**：先 search_events 找到事件 → get_event 獲取詳情
- **驗證點**：兩步驟執行順序正確

### 3. 刪除事件測試

#### 3.1 標準兩段式刪除
- **測試指令**：「刪除明天的客戶會議」
- **預期行為**：search_events → get_event → pending_confirmation → 用戶確認 → delete_event
- **驗證點**：嚴格的兩段式確認，不跳過任何步驟

#### 3.2 多個匹配結果
- **前置條件**：明天有多個會議
- **測試指令**：「刪除明天的會議」
- **預期行為**：顯示多個選項讓用戶選擇
- **驗證點**：不會誤刪其他會議

---

## 🧠 記憶功能測試

### 4. 建立事件記憶測試

#### 4.1 首次建立（正常流程）
- **測試指令**：「建立明天下午3點與 Alice 的會議」
- **預期行為**：完整的衝突檢查 → 確認 → 建立流程
- **驗證點**：所有步驟都執行

#### 4.2 重複建立（記憶檢測）
- **前置條件**：剛才的請求在記憶中
- **測試指令**：「建立明天下午3點與 Alice 的會議」（完全相同）
- **預期行為**：跳過衝突檢查 → 直接確認 → **仍需調用 create_event**
- **驗證點**：必須實際調用工具，不能只回覆「已建立」

### 5. 刪除事件記憶測試

#### 5.1 首次刪除（正常流程）
- **測試指令**：「刪除明天與 Bob 的會議」
- **預期行為**：完整的兩段式確認流程
- **驗證點**：用戶必須確認才執行

#### 5.2 重複刪除（記憶檢測）
- **前置條件**：剛才的刪除請求在記憶中
- **測試指令**：「刪除明天與 Bob 的會議」（完全相同）
- **預期行為**：跳過確認步驟 → **仍需調用 delete_event**
- **驗證點**：必須實際調用工具完成刪除

---

## ⚠️ 記憶陷阱測試（重要）

### 6. 防範假性完成測試

#### 6.1 Booking 假設測試
- **前置條件**：記憶中有類似的會議建立記錄
- **測試指令**：「幫我 booking 後天上午10點的重要會議」
- **錯誤行為**：❌ 直接回覆「已為您建立會議」
- **正確行為**：✅ 實際調用 create_event 工具
- **驗證點**：必須看到實際的工具調用

#### 6.2 快速連續請求測試
- **測試步驟**：
  1. 「建立明天2點會議」→ 確認 → 建立成功
  2. 立即「建立明天3點會議」
- **預期行為**：第二個請求仍需完整流程，不會因為記憶跳過
- **驗證點**：每個請求都有獨立的工具調用

---

## 🛡️ 錯誤處理測試

### 7. 參數錯誤測試

#### 7.1 時間格式錯誤
- **測試指令**：「建立明天 25:00 的會議」
- **預期行為**：error 狀態，說明時間格式問題
- **驗證點**：有意義的錯誤訊息

#### 7.2 缺少必要參數
- **測試指令**：「建立會議」（沒有時間）
- **預期行為**：error 狀態，說明缺少時間資訊
- **驗證點**：提示用戶補充資訊

### 8. 邊界情況測試

#### 8.1 過去時間建立
- **測試指令**：「建立昨天的會議」
- **預期行為**：適當的警告或拒絕
- **驗證點**：邏輯檢查正常

#### 8.2 不存在的事件操作
- **測試指令**：「刪除不存在的會議 ID」
- **預期行為**：error 狀態，說明事件不存在
- **驗證點**：錯誤處理正確

---

## 🔄 複雜流程測試

### 9. 衝突解決測試

#### 9.1 接受建議時段
- **步驟**：
  1. 嘗試建立衝突時間會議
  2. 收到建議時段
  3. 接受建議「好，改為下午3點」
- **預期行為**：用新時間重新執行建立流程
- **驗證點**：時間正確更新

#### 9.2 堅持原時間（強制執行）
- **步驟**：
  1. 嘗試建立衝突時間會議
  2. 收到衝突警告
  3. 再次要求相同時間「我就要2點」
- **預期行為**：記憶檢測觸發，跳過衝突檢查強制執行
- **驗證點**：成功建立重疊會議

### 10. 更新事件測試

#### 10.1 基本更新
- **測試指令**：「把明天2點的會議改到3點」
- **預期行為**：search_events → get_event → update_event
- **驗證點**：找到正確事件並更新

#### 10.2 更新不存在事件
- **測試指令**：「更新不存在的會議」
- **預期行為**：search_events 無結果 → error
- **驗證點**：適當的錯誤提示

---

## 📊 效能測試

### 11. 工具調用效率測試

#### 11.1 最少調用次數
- **測試**：建立簡單會議需要幾次工具調用
- **預期**：search_events（衝突檢查）→ create_event = 2次
- **驗證點**：沒有多餘的工具調用

#### 11.2 記憶優化效果
- **測試**：重複請求是否減少不必要的調用
- **預期**：跳過衝突檢查，但仍需建立事件
- **驗證點**：調用次數有所減少但不跳過關鍵步驟

---

## ✅ 測試檢查清單

### 每個測試都應驗證：
- [ ] 實際調用了正確的工具
- [ ] 工具參數格式正確
- [ ] 沒有憑記憶假設結果
- [ ] 錯誤處理適當
- [ ] 用戶體驗流暢
- [ ] 安全檢查有效

### 重點關注項目：
- [ ] **工具調用追蹤**：每個操作都能看到 `tool_calls` 不為空
- [ ] **記憶不替代執行**：重複請求仍會調用工具
- [ ] **兩段式刪除**：刪除操作必須經過確認
- [ ] **衝突檢查邏輯**：search_events 的 q 參數正確使用
- [ ] **錯誤恢復**：失敗後能正確重試

---

## 🚀 測試執行建議

1. **按順序執行**：從基本功能開始，逐步到複雜情況
2. **記錄結果**：每個測試都記錄實際 tool_calls 內容
3. **重點測試**：特別關注記憶陷阱防範測試
4. **邊界測試**：不要忽略錯誤情況
5. **真實場景**：模擬實際使用中的各種請求方式

記住：最重要的是確認 Agent 確實調用了工具，而不是僅僅基於記憶給出回應！
